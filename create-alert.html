<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅูุดุงุก ุชูุจูู - ูุธุงู ุงูุฅูุฐุงุฑ ุงููุจูุฑ</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/pages.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1 class="header-title" data-i18n="systemName">ูุธุงู ุงูุฅูุฐุงุฑ ุงููุจูุฑ</h1>
            <div class="header-user">
                <button class="language-toggle" id="langToggle">English</button>
                <div class="user-badge">
                    <span class="user-icon">๐ค</span>
                    <span id="userRole">ุงูุฃุฑุตุงุฏ ุงูุฌููุฉ</span>
                </div>
                <button class="logout-btn" id="logoutBtn" data-i18n="logout">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="create-alert-container">
        <h2 style="text-align: center; color: var(--color-primary); margin-bottom: 2rem;" data-i18n="createAlert">ุฅูุดุงุก
            ุชูุจูู</h2>

        <form id="alertForm">
            <!-- Basic Info Section -->
            <div class="form-section">
                <h3 class="form-section-title" data-i18n="alertLevel">ูุณุชูู ุงูุชูุจูู</h3>
                <div class="hazard-types">
                    <button type="button" class="hazard-btn hazard-btn-yellow" data-level="Yellow">
                        <div data-i18n="hazardTypes.Heatwave">ููุฌุฉ ุญุฑ</div>
                        <div data-i18n="alertLevels.Yellow">ุฃุตูุฑ</div>
                    </button>
                    <button type="button" class="hazard-btn hazard-btn-orange" data-level="Orange">
                        <div data-i18n="hazardTypes.Drought">ุฌูุงู</div>
                        <div data-i18n="alertLevels.Orange">ุจุฑุชูุงูู</div>
                    </button>
                    <button type="button" class="hazard-btn hazard-btn-red" data-level="Red">
                        <div data-i18n="hazardTypes.Flood">ููุถุงู</div>
                        <div data-i18n="alertLevels.Red">ุฃุญูุฑ</div>
                    </button>
                </div>
                <input type="hidden" id="alertLevel" required>
            </div>

            <!-- Alert Details -->
            <div class="form-section">
                <h3 class="form-section-title">ุชูุงุตูู ุงูุชูุจูู / Alert Details</h3>

                <div class="form-group">
                    <label class="form-label" for="hazardType" data-i18n="hazardType">ููุน ุงูุฎุทุฑ</label>
                    <select class="form-control" id="hazardType" required>
                        <option value="">-- ุงุฎุชุฑ --</option>
                        <option value="Flood" data-i18n-option="hazardTypes.Flood">ููุถุงู</option>
                        <option value="Heatwave" data-i18n-option="hazardTypes.Heatwave">ููุฌุฉ ุญุฑ</option>
                        <option value="Storm" data-i18n-option="hazardTypes.Storm">ุนุงุตูุฉ</option>
                        <option value="Drought" data-i18n-option="hazardTypes.Drought">ุฌูุงู</option>
                        <option value="Dust" data-i18n-option="hazardTypes.Dust">ุนุงุตูุฉ ุชุฑุงุจูุฉ</option>
                        <option value="Multi-Hazard" data-i18n-option="hazardTypes.Multi-Hazard">ูุฎุงุทุฑ ูุชุนุฏุฏุฉ</option>
                    </select>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label" for="validFrom" data-i18n="validFrom">ุตุงูุญ ูู</label>
                        <input type="datetime-local" class="form-control" id="validFrom" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="validTo" data-i18n="validTo">ุตุงูุญ ุญุชู</label>
                        <input type="datetime-local" class="form-control" id="validTo" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="affectedAreas" data-i18n="affectedGovernorates">ุงููุญุงูุธุงุช
                        ุงููุชุฃุซุฑุฉ</label>
                    <select class="form-control" id="affectedAreas" multiple size="5" required>
                        <option value="Ramallah">ุฑุงู ุงููู - Ramallah</option>
                        <option value="Jericho">ุฃุฑูุญุง - Jericho</option>
                        <option value="Jordan Valley">ุงูุฃุบูุงุฑ - Jordan Valley</option>
                        <option value="Gaza">ุบุฒุฉ - Gaza</option>
                        <option value="Hebron">ุงูุฎููู - Hebron</option>
                        <option value="Nablus">ูุงุจูุณ - Nablus</option>
                        <option value="Jenin">ุฌููู - Jenin</option>
                        <option value="Bethlehem">ุจูุช ูุญู - Bethlehem</option>
                    </select>
                    <small style="color: var(--color-gray-500);">ุงุถุบุท Ctrl ูุชุญุฏูุฏ ุนุฏุฉ ููุงุทู</small>
                </div>
            </div>

            <!-- Descriptions -->
            <div class="form-section">
                <h3 class="form-section-title">ุงููุตู ูุงููุตุงุฆุญ / Description & Advice</h3>

                <div class="form-group">
                    <label class="form-label" for="titleAr">ุงูุนููุงู (ุนุฑุจู)</label>
                    <input type="text" class="form-control" id="titleAr" required
                        placeholder="ูุซุงู: ููุฌุฉ ุญุฑ ูู ุฑุงู ุงููู">
                </div>

                <div class="form-group">
                    <label class="form-label" for="titleEn">Title (English)</label>
                    <input type="text" class="form-control" id="titleEn" required
                        placeholder="Example: Heatwave in Ramallah">
                </div>

                <div class="form-group">
                    <label class="form-label" for="descriptionAr">ุงููุตู (ุนุฑุจู)</label>
                    <textarea class="form-control" id="descriptionAr" rows="3" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="descriptionEn">Description (English)</label>
                    <textarea class="form-control" id="descriptionEn" rows="3" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="publicAdviceAr">ูุตุงุฆุญ ููุฌูููุฑ (ุนุฑุจู) - ุณุทุฑ ูุงุญุฏ ููู ูุตูุญุฉ</label>
                    <textarea class="form-control" id="publicAdviceAr" rows="3"
                        placeholder="ุงุจู ุฑุทุจูุง&#10;ุชุฌูุจ ุงูุณูุฑ ุบูุฑ ุงูุถุฑูุฑู"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="publicAdviceEn">Public Advice (English) - One per line</label>
                    <textarea class="form-control" id="publicAdviceEn" rows="3"
                        placeholder="Stay hydrated&#10;Avoid unnecessary travel"></textarea>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="window.location.href='admin-dashboard.html'">
                    <span data-i18n="cancel">ุฅูุบุงุก</span>
                </button>
                <button type="button" class="btn btn-secondary" onclick="saveAlert('Draft')">
                    <span data-i18n="saveAsDraft">ุญูุธ ููุณูุฏุฉ</span>
                </button>
                <button type="submit" class="btn btn-primary">
                    <span data-i18n="issueAlert">ุฅุตุฏุงุฑ ุงูุชูุจูู</span>
                </button>
            </div>
        </form>
    </main>

    <script src="js/i18n.js"></script>
    <script src="js/data.js"></script>
    <script>
        // Check authentication
        if (!DataManager.requireLogin() || !DataManager.hasRole('Meteorology')) {
            window.location.href = 'index.html';
        }

        let selectedLevel = null;

        // Update UI text
        function updateUIText() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = i18n.t(key);
            });

            document.querySelectorAll('[data-i18n-option]').forEach(el => {
                const key = el.getAttribute('data-i18n-option');
                el.textContent = i18n.t(key);
            });

            const user = DataManager.getCurrentUser();
            document.getElementById('userRole').textContent = i18n.t(`roles.${user.role}`);
            document.getElementById('langToggle').textContent = i18n.currentLanguage === 'ar' ? 'English' : 'ุนุฑุจู';
        }

        // Handle level selection
        document.querySelectorAll('.hazard-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.hazard-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedLevel = btn.getAttribute('data-level');
                document.getElementById('alertLevel').value = selectedLevel;
            });
        });

        // Set default datetime values
        const now = new Date();
        const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
        document.getElementById('validFrom').value = formatDateTimeLocal(now);
        document.getElementById('validTo').value = formatDateTimeLocal(tomorrow);

        function formatDateTimeLocal(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        // Save alert
        window.saveAlert = function (status) {
            const formData = collectFormData();
            if (!formData) return;

            formData.status = status;
            const alert = DataManager.createAlert(formData);

            alert(i18n.t('alertCreatedSuccess'));
            window.location.href = 'admin-dashboard.html';
        };

        // Handle form submission
        document.getElementById('alertForm').addEventListener('submit', (e) => {
            e.preventDefault();
            saveAlert('Active');
        });

        // Collect form data
        function collectFormData() {
            if (!selectedLevel) {
                alert(i18n.t('fillAllFields'));
                return null;
            }

            const affectedAreasSelect = document.getElementById('affectedAreas');
            const selectedAreas = Array.from(affectedAreasSelect.selectedOptions).map(opt => opt.value);

            if (selectedAreas.length === 0) {
                alert(i18n.t('fillAllFields'));
                return null;
            }

            const publicAdviceAr = document.getElementById('publicAdviceAr').value
                .split('\n').filter(line => line.trim());
            const publicAdviceEn = document.getElementById('publicAdviceEn').value
                .split('\n').filter(line => line.trim());

            return {
                title: {
                    ar: document.getElementById('titleAr').value,
                    en: document.getElementById('titleEn').value
                },
                hazardType: document.getElementById('hazardType').value,
                level: selectedLevel,
                validFrom: new Date(document.getElementById('validFrom').value).toISOString(),
                validTo: new Date(document.getElementById('validTo').value).toISOString(),
                affectedAreas: selectedAreas,
                description: {
                    ar: document.getElementById('descriptionAr').value,
                    en: document.getElementById('descriptionEn').value
                },
                publicAdvice: {
                    ar: publicAdviceAr,
                    en: publicAdviceEn
                },
                sectorRecommendations: {} // Could be expanded
            };
        }

        // Language toggle
        document.getElementById('langToggle').addEventListener('click', () => {
            i18n.toggle();
            updateUIText();
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            DataManager.logout();
        });

        // Listen for language changes
        window.addEventListener('languageChanged', updateUIText);

        // Initial load
        updateUIText();
    </script>
</body>

</html>